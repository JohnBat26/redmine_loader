<%= javascript_include_tag :loader, plugin: 'redmine_loader' %>
<h1><%= l(:import_tasks) %></h1>
<%= form_for(:import, {url: project_loader_path, html: {id: 'import', multipart: true}}) do |f| %>
  <%= hidden_field_tag "hashed_name", @import.hashed_name %>
  <% if @import.tasks.any? %>
    <p><%= l(:about_analyzed) %></p>
    <table border="0" cellspacing="0" cellpadding="2" align="center" class="bulk_task_import">
      <tr valign="middle" align="center" class="info">
        <th><%= link_to_function l(:import), 'toggleCheckboxesSelection(this);', class: 'import' %></th>
        <th>UID</th>
        <%= content_tag(:th, l(:name)) %>
        <%= content_tag(:th, l(:tracker)) %>
        <%= content_tag(:th, link_to_function(l(:start_date), 'clearDates(this);', class: 'start_date')) %>
        <%= content_tag(:th, link_to_function(l(:end_date), 'clearDates(this);', class: 'end_date')) %>
        <%= content_tag(:th, '%') unless ignore_field?(:done_ratio) %>
        <%= content_tag(:th, l(:assigned_to)) %>
        <%= content_tag(:th, l(:priority)) unless ignore_field?(:priority) %>
        <th><%= link_to_function l(:field_is_private), 'toggleCheckboxesSelection(this);', class: 'is_private' %></th>
        <%= content_tag(:th, l(:requires)) %>
      </tr>
      <% @import.tasks.each_with_index do |task, index| %>
        <%= render partial: 'task', locals: {task: task, index: index, dupes: @duplicates} %>
      <% end %>
      <tr>
        <td align="right" colspan="8">
          <%= check_box_tag :update_existing, "1", true, class: :update_existing %> <%= label_tag :update_existing, t(:update_existing), {class: :update_existing} %>
        </td>
        <td align="right" colspan="10"><%= f.submit(l(:import_selected), {name: 'import[import_selected]'}) %></td>
        <%= content_tag(:td, link_to(l(:back), {controller: 'loader', action: 'new'})) %>
      </tr>
    </table>
  <% end %>
  <% if @unprocessed_task_ids.any? %>
    <p align='center'><%= t(:duplicates_warning, ids: @unprocessed_task_ids.join(', ')) %></p>
  <% end %>
<% end %>
